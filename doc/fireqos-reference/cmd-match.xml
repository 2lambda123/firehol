<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
                 "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<!-- For license information see chapter-intro.xml -->
<refentry id="qos-match">

<refmeta>
<refentrytitle>traffic match: fireqos-match</refentrytitle>
<manvolnum>5</manvolnum>
</refmeta>

<refnamediv>
<refdescriptor>fireqos-match</refdescriptor>
<refname>fireqos-match</refname>
<refname>fireqos-match4</refname>
<refname>fireqos-match6</refname>
<refname>fireqos-match46</refname>
<refpurpose>define a traffic match</refpurpose>
</refnamediv>

<refsynopsisdiv>
  <cmdsynopsis>
    <command>match|match4|match6|match46</command>
    <arg choice="opt"><replaceable>optional-match-params</replaceable></arg>
  </cmdsynopsis>
</refsynopsisdiv>

<refsect1><title>Description</title>
  <para>
    Writing <command>match</command> inherits the IPv4/IPv6 version
    from its enclosing class (see <xref linkend="qos-class"/>).
  </para>

  <para>
    Writing <command>match4</command> includes only IPv4 traffic in the match.
  </para>

  <para>
    Writing <command>match6</command> includes only IPv6 traffic in the match.
  </para>

  <para>
    Writing <command>match46</command> includes both IPv4 and IPv6
    traffic in the match.
  </para>

  <para>
    You can add as many <command>match</command> statements as you like
    to a FireQOS configuration. They assign traffic to a class
    (see <xref linkend="qos-class"/>), by default to the class after
    which they are declared.
  </para>

  <para>
    The sequence that matches appear in the configuration defines
    their priority, with the first match being given a <option>prio</option>
    of 10, with 10 added for each subsequent match (10, 20, 30, ...).
  </para>

  <para>
    Matches can have their priority assigned explicitly with the
    <option>prio</option> parameter. See <xref linkend="qos-match-params"/>.
  </para>

  <para>
    If one <command>match</command> statement generates
    multiple <command>tc filter</command> statements, all filters generated
    by the same <command>match</command> statement will have the
    same <option>prio</option>.
  </para>

  <note><para>
    <command>match</command> rules are attached to the parent of the
    <command>class</command> they appear in. Within the configuration
    they are written under a class, but in reality they are
    attached to their class parent, so that they classify the parent's
    traffic that they match, into the class.
  </para></note>

  <para>
    It is also possible to group all <command>match</command> statements
    together below the classes. This allows them to be arranged in
    preferred order, without the need for any explicit <option>prio</option>
    parameters. In this case however, each match statement must specify to
    which class it classifies the packets it matches, using the
    <option>class</option> parameter. See <xref linkend="qos-match-params"/>
    and the examples below.
  </para>
</refsect1>

<refsect1><title>Parameters</title>
  <variablelist>
    <varlistentry><term><replaceable>optional-match-params</replaceable></term>
      <listitem>
        <para>
          The set of optional parameters which describe this match.
          See <xref linkend="qos-match-params"/>.
        </para>
      </listitem>
    </varlistentry>
  </variablelist>
</refsect1>

<refsect1><title>Examples</title>
  <para>Match traffic within classes:
    <programlisting>
interface eth0 lan output rate 1Gbit
  class voip
    match udp ports 5060,10000:10100
  class dns
    match udp port 53
  class mail
    match tcp port 25
    </programlisting>
  </para>

  <para>Matches split out and explicitly assigning traffic to classes
(N.B. without the <option>class</option> parameters, all traffic would
be classified into 'mail'):
    <programlisting>
interface eth0 lan output rate 1Gbit
  class voip
  class dns
  class mail

  match udp ports 5060,10000:10100 class voip
  match tcp port 25 class mail
  match tcp port 80 class web
    </programlisting>
  </para>
</refsect1>

<refsect1><title>See Also</title>
  <simplelist type="vert">
    <member><xref linkend="fireqos"/></member>
    <member><xref linkend="fireqos.conf"/></member>
    <member><xref linkend="qos-match-params"/></member>
    <member><xref linkend="qos-interface"/></member>
    <member><xref linkend="qos-class"/></member>
  </simplelist>
</refsect1>

</refentry>
