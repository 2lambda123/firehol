#
# $Id: home-router.conf,v 1.3 2002/11/30 14:33:33 ktsaou Exp $
#
# $Log: home-router.conf,v $
# Revision 1.3  2002/11/30 14:33:33  ktsaou
# As suggested by Florian Thiel <thiel@ksan.de>:
# a. Fixed service IRC to work on TCP instead of UDP.
# b. Added services: UUCP, VNC, WEBCACHE, IMAPS, IKE.
#
# Also fixed the home-router.conf example (it was outdated).
#
# Revision 1.2  2002/10/27 12:47:48  ktsaou
# Added CVS versioning to all files.
#
#

version 5

# ----------------------------------------------------------
# Custom Rules

# This is needed because I run a transparent cache.
# The command is not executed right away, it will be processed
# when the firewall will be activated.
# HINT: This is a normal iptables command. Nothing fancy.
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 ! -d 1.1.1.1 -j REDIRECT --to-port 3128


# ----------------------------------------------------------
# Some definitions, you can define whatever you like...
# ----------------------------------------------------------
# The IP address space on our LAN
lan="1.1.1.1/28"

# The tructed IPs from our office
secure="2.2.2.2/32"


# Give the name "internet" to everything comming from ppp+
# making sure they don't have our LAN IP addresses.
interface ppp+ internet src not "${lan}"
	policy drop			# This is also the default
	protection strong 1/sec 1	# Also, limit incoming reqs to 1/sec
	
	# Public Services
	server smtp	accept		# Yes, we run a mailer
	server ident	reject		# Speed-up idents by rejecting them
	
	# Trusted Services
	server ssh	accept src "${secure}"
	
	# This is a workstation
	client all	accept		# This machine can ask anything
					# For correct accounting, put this last
	
# Give the name "home" to our local LAN
interface eth0 home
	policy accept			# Accept everything from/to home
	

# Give the name "router" to all requests comming from eth0 AND our local IP
# address space, and going out to ppp+
router router inface eth0 outface ppp+ src "${lan}"
	route all	accept		# Accept all client from eth0 to ppp+
